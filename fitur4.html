
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>kamar</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 12px;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 16px;
    }

    h1 {
      text-align: center;
      font-size: 1.4em;
      margin: 0 0 20px;
      color: #333;
    }

    /* üîô Kembali ke Beranda */
    .back-home {
      text-align: center;
      margin: 12px 0;
    }
    .back-home a {
      display: inline-block;
      padding: 10px 20px;
      background: #4285f4;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-weight: bold;
      font-size: 0.95em;
    }
    .back-home a:hover {
      background: #3367d6;
    }

    .action-buttons {
      display: flex;
      gap: 8px;
      margin: 12px 0 20px;
    }
    .action-buttons button {
      flex: 1;
      padding: 10px;
      font-size: 14px;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .btn-save {
      background: #34a853;
      color: white;
    }
    .btn-save:hover {
      background: #2d8f47;
    }
    .btn-clear {
      background: #ea4335;
      color: white;
    }
    .btn-clear:hover {
      background: #d33426;
    }

    .input-group {
      margin: 12px 0;
    }

    label {
      display: block;
      font-weight: bold;
      margin-bottom: 6px;
      color: #555;
      font-size: 0.95em;
    }

    input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
    }

    button#btn-hitung {
      width: 100%;
      padding: 14px;
      background: #673ab7;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin: 16px 0;
    }

    button#btn-hitung:active {
      background: #512da8;
      transform: scale(0.99);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 16px;
    }

    th, td {
      padding: 12px 8px;
      text-align: center;
      border: 1px solid #ddd;
    }

    th {
      background-color: #f8f9fa;
      color: #333;
    }

    .rumus-tag {
      color: #d32f2f;
      font-weight: bold;
      font-size: 15px;
    }

    @media (max-width: 480px) {
      .container {
        padding: 12px;
      }
      th, td {
        padding: 10px 6px;
        font-size: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üî¢ kamar</h1>

    <!-- üîô Kembali ke Beranda -->
    <div class="back-home">
      <a href="index.html">üîô Kembali ke Beranda</a>
    </div>

    <div class="input-group">
      <label for="tanggalSebelum">Tanggal Pemutaran Sebelumnya</label>
      <input type="text" id="tanggalSebelum" placeholder="Contoh: 10" inputmode="numeric" />
    </div>

    <div class="input-group">
      <label for="tanggalSekarang">Tanggal Pemutaran Sekarang</label>
      <input type="text" id="tanggalSekarang" placeholder="Contoh: 11" inputmode="numeric" />
    </div>

    <div class="input-group">
      <label for="result4DLalu">4D Result Sebelumnya</label>
      <input type="text" id="result4DLalu" placeholder="Contoh: 4796" inputmode="numeric" maxlength="4" />
    </div>

    <div class="input-group">
      <label for="result4D">4D Result Sekarang</label>
      <input type="text" id="result4D" placeholder="Contoh: 7890" inputmode="numeric" maxlength="4" />
    </div>

    <button id="btn-hitung">Terapkan Semua Rumus</button>

    <!-- Tombol Simpan & Hapus -->
    <div class="action-buttons">
      <button id="btn-simpan" class="btn-save">üíæ Simpan</button>
      <button id="btn-hapus" class="btn-clear">üóëÔ∏è Hapus</button>
    </div>

    <table id="kamar-table">
      <thead>
        <tr>
          <th>Kamar</th>
          <th>Rumus Lemah</th>
        </tr>
      </thead>
      <tbody id="kamar-body">
        <!-- Diisi otomatis -->
      </tbody>
    </table>
  </div>

  <script>
    const shioAngka = {
      1: [1,13,25,37,49,61,73,85,97],
      2: [2,14,26,38,50,62,74,86,98],
      3: [3,15,27,39,51,63,75,87,99],
      4: [4,16,28,40,52,64,76,88],
      5: [5,17,29,41,53,65,77,89],
      6: [6,18,30,42,54,66,78,90],
      7: [7,19,31,43,55,67,79,91],
      8: [8,20,32,44,56,68,80,92],
      9: [9,21,33,45,57,69,81,93],
      10: [10,22,34,46,58,70,82,94],
      11: [11,23,35,47,59,71,83,95],
      12: [12,24,36,48,60,72,84,96]
    };

    function buatTabelKamar() {
      const tbody = document.getElementById("kamar-body");
      tbody.innerHTML = "";
      for (let i = 1; i <= 12; i++) {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${i}</td><td id="rumus-${i}">‚Äî</td>`;
        tbody.appendChild(row);
      }
    }

    function getIndex(angka) { return (angka + 5) % 10; }
    function angkaKeShio(n) { n = n % 12; return n === 0 ? 12 : n; }

    function hitungDasar2D(duaD) {
      let total = duaD < 10 ? duaD : parseInt(duaD.toString()[0]) + parseInt(duaD.toString()[1]);
      while (total >= 10) total = String(total).split('').reduce((sum, d) => sum + parseInt(d), 0);
      return total === 0 ? 9 : total;
    }

    function hitungKamarLemah(tglSeb, tglSkr, empatDLalu, empatDSkr) {
      const kamarRumus = {};
      for (let i = 1; i <= 12; i++) kamarRumus[i] = new Set();

      let str4D = empatDSkr.toString().padStart(4, '0');
      const AS = +str4D[0], KOP = +str4D[1], KEPALA = +str4D[2], EKOR = +str4D[3], duaD = KEPALA * 10 + EKOR;
      let str4DLalu = empatDLalu.toString().padStart(4, '0');
      const AS_Lalu = +str4DLalu[0];

      kamarRumus[angkaKeShio(tglSkr)].add(1);
      kamarRumus[angkaKeShio(tglSkr + 7)].add(2);
      kamarRumus[angkaKeShio(tglSeb + tglSkr)].add(3);
      kamarRumus[angkaKeShio(hitungDasar2D(duaD) + tglSkr)].add(4);
      kamarRumus[angkaKeShio(100 - duaD)].add(5);
      kamarRumus[angkaKeShio(99 - duaD)].add(6);
      kamarRumus[angkaKeShio(getIndex(AS) * 10 + getIndex(KOP))].add(7);
      kamarRumus[angkaKeShio(getIndex(KEPALA) * 10 + getIndex(EKOR))].add(8);
      kamarRumus[angkaKeShio(AS * 10 + KOP)].add(9);
      kamarRumus[angkaKeShio(KOP * 10 + KEPALA)].add(10);

      const digitKepala = KEPALA.toString();
      for (let s = 1; s <= 12; s++) {
        if (!shioAngka[s].some(num => num.toString().padStart(2, '0').includes(digitKepala)))
          kamarRumus[s].add(11);
      }

      const digitEkor = EKOR.toString();
      for (let s = 1; s <= 12; s++) {
        if (!shioAngka[s].some(num => num.toString().padStart(2, '0').includes(digitEkor)))
          kamarRumus[s].add(12);
      }

      kamarRumus[angkaKeShio(AS * 10 + EKOR)].add(13);
      kamarRumus[angkaKeShio(getIndex(AS_Lalu) * 10 + getIndex(AS))].add(14);

      // üîπ === TAMBAHAN: Rumus 15, 16, 17 (berdasarkan 6 digit) ===
      // Bangun 6 digit dari gabungan 4D lalu + 4D sekarang ‚Üí ambil 6 digit terakhir
      let str4DLalu6 = empatDLalu.toString().padStart(4, '0');
      let str4DSkr6 = empatDSkr.toString().padStart(4, '0');
      const combined8 = str4DLalu6 + str4DSkr6; // contoh: "47967890"
      const result6 = combined8.slice(-6).padStart(6, '0'); // "967890"

      // Rumus 15: Jumlah semua digit + 9 ‚Üí ambil 2 digit terakhir ‚Üí cari kamar
      let sum15 = 0;
      for (const char of result6) sum15 += parseInt(char, 10);
      sum15 += 9;
      const target2D_15 = String(sum15).padStart(2, '0').slice(-2);
      const angka15 = parseInt(target2D_15, 10);
      kamarRumus[angkaKeShio(angka15)].add(15);

      // Rumus 16: Digit ke-1 (A) dan ke-3 (C) dari result6 ‚Üí bentuk 2D ‚Üí kamar
      const ac2D = result6[0] + result6[2]; // string, misal: "97"
      const angka16 = parseInt(ac2D, 10);
      kamarRumus[angkaKeShio(angka16)].add(16);

      // Rumus 17: Jumlah semua digit mod 12
      let sum17 = 0;
      for (const char of result6) sum17 += parseInt(char, 10);
      const mod17 = sum17 % 12;
      const shio17 = mod17 === 0 ? 12 : mod17;
      kamarRumus[shio17].add(17);
      // üîπ === AKHIR TAMBAHAN ===

      return kamarRumus;
    }

    function tampilkanKamarLemah(kamarRumus) {
      for (let i = 1; i <= 12; i++) {
        const cell = document.getElementById(`rumus-${i}`);
        const list = Array.from(kamarRumus[i]).sort((a, b) => a - b);
        cell.innerHTML = list.length === 0 ? "‚Äî" : `<span class="rumus-tag">${list.join(",")}</span>`;
      }
    }

    // üîπ LOCALSTORAGE
    const STORAGE_KEY = 'kamar_data';

    function simpanKeStorage() {
      const data = {
        tanggalSebelum: document.getElementById('tanggalSebelum').value.trim(),
        tanggalSekarang: document.getElementById('tanggalSekarang').value.trim(),
        result4DLalu: document.getElementById('result4DLalu').value.trim(),
        result4D: document.getElementById('result4D').value.trim(),
        hasil: {}
      };

      // Simpan hasil per kamar
      for (let i = 1; i <= 12; i++) {
        const cell = document.getElementById(`rumus-${i}`);
        if (cell && cell.textContent !== "‚Äî") {
          data.hasil[i] = cell.textContent;
        }
      }

      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function muatDariStorage() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          const data = JSON.parse(saved);
          document.getElementById('tanggalSebelum').value = data.tanggalSebelum || '';
          document.getElementById('tanggalSekarang').value = data.tanggalSekarang || '';
          document.getElementById('result4DLalu').value = data.result4DLalu || '';
          document.getElementById('result4D').value = data.result4D || '';

          if (data.hasil) {
            // Tunggu tabel dibuat
            setTimeout(() => {
              for (let i = 1; i <= 12; i++) {
                const cell = document.getElementById(`rumus-${i}`);
                if (cell && data.hasil[i]) {
                  cell.innerHTML = `<span class="rumus-tag">${data.hasil[i]}</span>`;
                }
              }
            }, 50);
          }
        } catch (e) {
          console.error('Gagal memuat data kamar:', e);
        }
      }
    }

    function bersihkanSemua() {
      document.getElementById('tanggalSebelum').value = '';
      document.getElementById('tanggalSekarang').value = '';
      document.getElementById('result4DLalu').value = '';
      document.getElementById('result4D').value = '';
      buatTabelKamar();
      localStorage.removeItem(STORAGE_KEY);
    }

    // üîπ EVENT HANDLERS
    document.getElementById("btn-hitung").addEventListener("click", () => {
      const seb = document.getElementById("tanggalSebelum").value.trim();
      const skr = document.getElementById("tanggalSekarang").value.trim();
      const laluStr = document.getElementById("result4DLalu").value.trim();
      const skr4DStr = document.getElementById("result4D").value.trim();

      if (!seb || !skr || !laluStr || !skr4DStr) {
        alert("Harap isi semua kolom.");
        return;
      }

      const tglSeb = parseInt(seb, 10);
      const tglSkr = parseInt(skr, 10);
      const empatDLalu = parseInt(laluStr, 10);
      const empatDSkr = parseInt(skr4DStr, 10);

      if (isNaN(tglSeb) || isNaN(tglSkr) || tglSeb < 1 || tglSeb > 31 || tglSkr < 1 || tglSkr > 31) {
        alert("Tanggal harus angka 1‚Äì31.");
        return;
      }

      if (isNaN(empatDLalu) || isNaN(empatDSkr) || empatDLalu < 0 || empatDLalu > 9999 || empatDSkr < 0 || empatDSkr > 9999) {
        alert("4D harus angka 0‚Äì9999.");
        return;
      }

      const hasil = hitungKamarLemah(tglSeb, tglSkr, empatDLalu, empatDSkr);
      tampilkanKamarLemah(hasil);
      simpanKeStorage(); // Simpan otomatis setelah hitung
    });

    document.getElementById('btn-simpan').addEventListener('click', () => {
      const seb = document.getElementById("tanggalSebelum").value.trim();
      const skr = document.getElementById("tanggalSekarang").value.trim();
      const lalu = document.getElementById("result4DLalu").value.trim();
      const skr4D = document.getElementById("result4D").value.trim();

      if (!seb || !skr || !lalu || !skr4D) {
        alert("‚ö†Ô∏è Lengkapi semua input terlebih dahulu.");
        return;
      }
      simpanKeStorage();
      alert("‚úÖ Data berhasil disimpan ke localStorage!");
    });

    document.getElementById('btn-hapus').addEventListener('click', () => {
      if (confirm("Yakin hapus semua data?")) {
        bersihkanSemua();
        alert("üóëÔ∏è Semua data telah dihapus.");
      }
    });

    // üîπ MUAT SAAT DIBUKA
    document.addEventListener("DOMContentLoaded", () => {
      buatTabelKamar();
      muatDariStorage();
    });
  </script>
</body>
</html>
